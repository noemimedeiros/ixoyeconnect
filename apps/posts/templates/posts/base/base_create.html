{% extends "core/dashboard.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block style %}
<link rel="stylesheet" href="{% static 'posts/css/posts.css' %}">
<style>
    .card-post{
        width: 230px
    }
    @media (max-width: 768px) {
        .card-post{
            width: 100%
        }
    }
</style>
{% endblock style %}

{% block app_title %}
{{ titulo|default:"Criar post" }}
{% endblock app_title %}

{% block dashboard_actions %}
{% endblock dashboard_actions %}

{% block dashboard_content %}
<span>Preencha os dados abaixo</span>
<section class="form-posts">
    <div>
        {% include "core/includes/foto_preview.html" with img_src=object.capa.url  %}
        {% crispy form %}
    </div>
    <div>
        <div class="post-preview">
            <div class="mb-4"><small>Pré-Visualização</small></div>
            {% include "posts/partials/card_post.html" with post=object %}
        </div>
    </div>
</section>
{% endblock dashboard_content %}

{% block _scripts %}
<script>
    $('#id_capa').change(() => fotoPreview('id_capa'))
    $('#foto-preview-div').click(() => $('#id_capa').trigger('click'));
    const usuario = '{{ request.user.conta.nome }}';

    function cardPost(){
        let hoje = new Date();
        hoje = hoje.toLocaleDateString();

        let titulo = $('#id_titulo').val();
        let descricao = editors.id_descricao.getData();
        fotoPreview('id_capa', '.card-post-capa');

        $('.card-post-titulo').html(titulo)
        $('.card-post-descricao').html(descricao);
        $('.card-post-info').html(`${hoje} - ${usuario}`)
    }

    $('input').on('change input', () => cardPost())
    $(function(){
        editors.id_descricao.model.document.on('change:data', () => cardPost())
    })
</script>
{% endblock _scripts %}